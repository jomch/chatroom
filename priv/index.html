<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>英语聊天室 - englishzone.cn</title>
	<link href="static/bootstrap.min.css" rel="stylesheet">
    <script src="static/jquery.min.js"></script>
    <script type="text/javascript">

	var ws;
	var wsHost = "ws://192.168.9.10:8088/websocket";

	$(function(){
		if(!("WebSocket" in window)){  
			$('#status').append('<p><span style="color: red;">websockets are not supported </span></p>');
			$("#navigation").hide();  
		} else {
			$('#status').append('<p><span style="color: green;">websockets are supported </span></p>');
			connect();
		};
		$("#connected").hide(); 	
		$("#content").hide(); 
	});
    
	function connect() {
		ws = new WebSocket(wsHost);
		showScreen('<b>Connecting to: ' +  wsHost + '</b>'); 
		ws.onopen = function(evt) { onOpen(evt); }; 
		ws.onclose = function(evt) { onClose(evt) }; 
		ws.onmessage = function(evt) { onMessage(evt) }; 
		ws.onerror = function(evt) { onError(evt) }; 
	}

	function disconnect() {
		ws.close();
	}

	function toggle_connection(){
		if(ws.readyState == ws.OPEN){
			disconnect();
		} else {
			connect();
		}
	}

	function sendTxt() {
		if(ws.readyState == ws.OPEN){
			txt = $("#send_txt").val();
			ws.send(txt);
			showScreen('Client: ' + txt); 
		} else {
			showScreen('websocket is not connected'); 
		}
	}

	function onOpen(evt) { 
		showScreen('<span style="color: green;">CONNECTED </span>');
		$("#connected").fadeIn('slow');
		$("#content").fadeIn('slow');
	}

	function onClose(evt) {
		showScreen('<span style="color: red;">DISCONNECTED </span>');
	}

	function onMessage(evt) { 
		showScreen('<span style="color: blue;">' + evt.data+ '</span>'); 
	}

	function onError(evt) {
		showScreen('<span style="color: red;">ERROR: ' + evt.data+ '</span>');
	}

	function showScreen(txt) { 
		$('#output').prepend('<p>' + txt + ' ['+getNowTime()+']</p>');
	}

	function clearScreen() { 
		$('#output').html("");
	}

	function getNowTime() {
		var date = new Date();
		var h = date.getHours();
		var i = date.getMinutes();
		var s = date.getSeconds();
		return (h<10?'0'+h:h)+':'+(i<10?'0'+i:i)+':'+(s<10?'0'+s:s);
	}

</script>
</head>

<body>

<div class="container">
	<div class="row">
		<div class="col-lg-12">

			<div class="jumbotron">
				<div class="row">
					<div class="col-lg-12"><h3 style="text-align:center;">英语聊天室(englishzone.cn)</h3></div>
				</div>
				<div class="row pre-scrollable" style="height:600px;border:1px solid #000;background-color:#fff;margin-top:30px;">
					<div class="col-lg-12"></div>
				</div>
				<div class="row" style="margin-top:20px;">
					<div class="col-lg-12">
					<center>
						<form class="form-inline">
							  <div class="form-group">
								<label for="nickname" class="sr-only">nickname</label>
								<input type="text" class="form-control" id="nickname" placeholder="昵称" style="width:130px;">
							  </div>
							  <div class="form-group">
								<label for="chat_content" class="sr-only">chat_content</label>
								<input type="text" size=50 class="form-control" id="chat_content" placeholder="聊天内容" style="width:500px;">
							  </div>
							  <button type="submit" class="btn btn-Primary">发送</button>
						</form>
					</center>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>




<!--
    <div id="header">
      <h1>Websocket client</h1>
      <div id="status"></div>
    </div>


    <div id="navigation">

      <p id="connecting">
	<input type='text' id="server" value=""></input>
	<button type="button" onclick="toggle_connection()">connection</button>
      </p>
      <div id="connected">				
	<p>
	  <input type='text' id="send_txt" value=></input>
	  <button type="button" onclick="sendTxt();">send</button>
	</p>
      </div>

      <div id="content">						
	<button id="clear" onclick="clearScreen()" >Clear text</button>
	<div id="output"></div>
      </div>

    </div>
//-->
</body>
</html>